

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bayesian approach for the rating model &#8212; Bayesian Book</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-dropdown.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Uncertainty of unique clicks rate in searches per platforms" href="Example%20Performance%20of%20searches%20per%20platform.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  
  <h1 class="site-logo" id="site-title">Bayesian Book</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../introduction.html">
   <!-- #raw -->
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Statistic Bayesian 001
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../Basics%20in%20Statistic%20Bayesian.html">
   Basics in Statistic Bayesian
   <a class="anchor" id="chapter1">
   </a>
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Prio and Posterior
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../BinomialPriorPosterior.html">
   Prios and Posterior : The binomial case
   <a class="anchor" id="chapter binomial prior">
   </a>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../OtherPriorPosterior.html">
   Other Prior and Posterior models
   <a class="anchor" id="chapter4">
   </a>
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Practice in Adevinta
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1 current active">
  <a class="reference internal" href="../Examples%20in%20Adevinta.html">
   Examples in Adevinta
   <a class="anchor" id="chapter5">
   </a>
  </a>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="Example%20Searches%20with%20Clicks.html">
     Uncertainty of unique clicks rate in searches:
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Example%20Performance%20of%20searches%20per%20platform.html">
     Uncertainty of unique clicks rate in searches per platforms
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Bayesian approach for the rating model
    </a>
   </li>
  </ul>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/chaptExamples/Example Ratings.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/executablebooks/jupyter-book"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2FchaptExamples/Example Ratings.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/docs/chaptExamples/Example Ratings.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/executablebooks/jupyter-book/blob/master/docs/chaptExamples/Example Ratings.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#references">
   References
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#section1-binary-system-up-down">
   Section1: Binary system (up-down)
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#choises-for-the-prio">
   Choises for the Prio
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#hypothesis-1">
     Hypothesis 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#hypothesis-2">
     Hypothesis 2
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#hypothesis-3">
     Hypothesis 3
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#posterior-distributions">
   Posterior distributions
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#posterior-from-prio-1">
     Posterior from  Prio 1
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#posterior-from-prio-2">
     Posterior from  Prio 2
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#posterior-from-prio-3">
     Posterior from  Prio 3
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#section2-from-binary-to-multirating">
   Section2: From binary to multirating
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#section3-the-real-case-rating-for-the-buyers-and-sellers">
   Section3: The real case: rating for the buyers and sellers
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#group-buyer-and-seller-and-classifies-by-mean-of-average">
     Group buyer and seller and classifies by mean of average
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#bayesian-rating">
   Bayesian rating
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#question-is-the-overall-score-of-buyers-different-from-the-sellers-ones-are-more-critical-the-buyers-or-the-sellers">
   Question: Is the overall score of Buyers different from the Sellers ones? Are more critical the Buyers or the Sellers?
  </a>
 </li>
</ul>

        </nav>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="bayesian-approach-for-the-rating-model">
<h1>Bayesian approach for the rating model<a class="headerlink" href="#bayesian-approach-for-the-rating-model" title="Permalink to this headline">¶</a></h1>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<p>Some references for this analysis and some interesting readings</p>
<p><a class="reference external" href="https://towardsdatascience.com/bayesian-ranking-system-77818e63b57b">Bayesian star rating approach</a>
<a class="reference external" href="https://rpubs.com/pteridin/694049">Bayesian product decision</a></p>
<p><a class="reference external" href="https://www.johndcook.com/blog/2011/09/27/bayesian-amazon/">A Bayesian view of Amazon Resellers</a></p>
<p><a class="reference external" href="https://www.evanmiller.org/how-not-to-sort-by-average-rating.html">WilsonScore</a></p>
<p><a class="reference external" href="https://medium.com/district-data-labs/computing-a-bayesian-estimate-of-star-rating-means-651496a890ab">Bayesian Estimator</a></p>
<p><a class="reference external" href="https://www.codementor.io/&#64;arpitbhayani/solving-an-age-old-problem-using-bayesian-average-15fy4ww08p">Aritmetic vs Bayesian average</a></p>
<p><a class="reference external" href="https://www.algolia.com/doc/guides/solutions/ecommerce/search-relevance/tutorials/bayesian-average/">Bayesian Average 1</a>
<a class="reference external" href="https://www.evanmiller.org/bayesian-average-ratings.html">Bayesian Average 2</a>
<a class="reference external" href="https://fulmicoton.com/posts/bayesian_rating/">Bayesian average 3</a></p>
</div>
<div class="section" id="section1-binary-system-up-down">
<h2>Section1: Binary system (up-down)<a class="headerlink" href="#section1-binary-system-up-down" title="Permalink to this headline">¶</a></h2>
<p>We can use the Bayesian statistics to build a ranking system.
Let’s start with a basic example of binary output:
a product ranking website where users vote up/down on a product.</p>
<p>Simple ranking schemes like percentage of positive votes or up minus down votes perform poorly.
Example:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\textrm{Percentage}\)</span>: 60 up : 40 down — vs — 6 up : 4 down are both 60 <span class="math notranslate nohighlight">\(\%\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\textrm{v}\)</span>: 100 up : 95 down vs 5 up : 0 down are both +5</p></li>
</ul>
<p>Those approaches don’t take into consideration that there’s much more data on one than the other.
A Bayesian view of the problem naturally incorporates the amount of data as well as its average.</p>
<p>What we would like is for more votes to add more information: 60 votes hold more information than 6 votes. Let’s use the votes as likelihoods in Bayesian inference.</p>
<p>Here’s a set of movies A-E with up/down votes:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>product id</p></th>
<th class="head"><p>up</p></th>
<th class="head"><p>down</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>A</p></td>
<td><p>60</p></td>
<td><p>40</p></td>
</tr>
<tr class="row-odd"><td><p>B</p></td>
<td><p>6</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>C</p></td>
<td><p>6</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-odd"><td><p>D</p></td>
<td><p>1</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-even"><td><p>E</p></td>
<td><p>10</p></td>
<td><p>20</p></td>
</tr>
</tbody>
</table>
<p>and considering the general expression obtained in chapter 3 for the posterior with prior distribution given by a Beta function which is:</p>
<div class="math notranslate nohighlight">
\[
f(\theta| y) \sim Beta(\alpha+\sum y_i, \beta+n-\sum y_i)
\]</div>
<p>we can obtain a posterior probability that the product will be voted as good or not. To do that, we need to define a prior beta distribution.</p>
<p>To choose a prior distribution, we need to do some hypothesis. Remember from the theory that we can always check the effect of this hypotesis in the posterior and build a predictive interval.</p>
</div>
<div class="section" id="choises-for-the-prio">
<h2>Choises for the Prio<a class="headerlink" href="#choises-for-the-prio" title="Permalink to this headline">¶</a></h2>
<p>There are some choises for the choise of the prio based on our prio knowledge and hypotesis:</p>
<ul class="simple">
<li><p>We really don’t know what would be the distribution of the votes (<span class="math notranslate nohighlight">\(\textrm{Hyp 1}\)</span>)</p></li>
<li><p>We know that average product are more common than extremely good or extremely bad product. We’d prefer a ranking which started with an assumption of average product and required evidence to move to the extremes  (<span class="math notranslate nohighlight">\(\textrm{Hyp 2}\)</span>)</p></li>
<li><p>The product manager is preatty confident that all the product will receive good valuation (<span class="math notranslate nohighlight">\(\textrm{Hyp 3}\)</span>)</p></li>
</ul>
<div class="section" id="hypothesis-1">
<h3>Hypothesis 1<a class="headerlink" href="#hypothesis-1" title="Permalink to this headline">¶</a></h3>
<p>In this case, a choise is the non informative prio. We opt for a non informative prio with uniform distribution: Beta(1,1)</p>
</div>
<div class="section" id="hypothesis-2">
<h3>Hypothesis 2<a class="headerlink" href="#hypothesis-2" title="Permalink to this headline">¶</a></h3>
<p>In this case, we want a prio distribution with a peack to the average of the vote so <span class="math notranslate nohighlight">\(\alpha= \beta &gt;1\)</span>
Remember that for a distribution of <span class="math notranslate nohighlight">\( X \sim Beta(\alpha,\beta)  \)</span> the average and standard distribution are respectively:</p>
<div class="math notranslate nohighlight">
\[E[X] = \frac{\alpha}{\alpha +\beta} \]</div>
<div class="math notranslate nohighlight">
\[Var(X)= \frac{\alpha \beta}{(\alpha +\beta)^2 (\alpha +\beta+1)} \]</div>
<p>If <span class="math notranslate nohighlight">\(\alpha=\beta\)</span> the <span class="math notranslate nohighlight">\(E[X]=0.5\)</span> and the <span class="math notranslate nohighlight">\(Var(X)= \frac{1}{4(2 \alpha +1)}\)</span>. The greater is the value of <span class="math notranslate nohighlight">\(\alpha\)</span>, the lower will be the dispersion around the mean.</p>
<p>For example let’s try the shape of a Beta(11,11)</p>
</div>
<div class="section" id="hypothesis-3">
<h3>Hypothesis 3<a class="headerlink" href="#hypothesis-3" title="Permalink to this headline">¶</a></h3>
<p>In this case we want a distribution peaked around the max vote (in the binary case is 1, in a 5 star system, would be 5). Again we can control the distribution of the prio by playing with the parameters <span class="math notranslate nohighlight">\(\alpha\)</span> and <span class="math notranslate nohighlight">\(\beta\)</span> but let’s try a prio with a Beta(20,1).</p>
<p>Next plot shows the three distribution described:</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="k">import</span> <span class="n">beta</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1001</span><span class="p">)</span>
<span class="n">b1</span> <span class="o">=</span> <span class="n">beta</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;Hypotesis 1 &quot;</span> <span class="p">)</span>
<span class="n">axes</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

<span class="n">b2</span> <span class="o">=</span> <span class="n">beta</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;Hypotesis 2 &quot;</span> <span class="p">)</span>
<span class="n">axes</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

<span class="n">b3</span> <span class="o">=</span> <span class="n">beta</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">b3</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;Hypotesis 3 &quot;</span> <span class="p">)</span>
<span class="n">axes</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">b3</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

<span class="n">axes</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Prior Distributions&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7f77be8abcd0&gt;
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="posterior-distributions">
<h2>Posterior distributions<a class="headerlink" href="#posterior-distributions" title="Permalink to this headline">¶</a></h2>
<p>With the previous prior,let’s see how the posteriors look like considering the general formulation recalled in the introduction.
Moreover, since the beta distribution is a PDF  we’ll need   to convert to a scalar for ranking. One way is to find the minimum value of the beta distribution such that we are 95% confident the true value is greater.</p>
<div class="section" id="posterior-from-prio-1">
<h3>Posterior from  Prio 1<a class="headerlink" href="#posterior-from-prio-1" title="Permalink to this headline">¶</a></h3>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>product id</p></th>
<th class="head"><p>up</p></th>
<th class="head"><p>down</p></th>
<th class="head"><p>Posterior</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>A</p></td>
<td><p>60</p></td>
<td><p>40</p></td>
<td><p>Beta(61,41)</p></td>
</tr>
<tr class="row-odd"><td><p>B</p></td>
<td><p>6</p></td>
<td><p>1</p></td>
<td><p>Beta(7,2)</p></td>
</tr>
<tr class="row-even"><td><p>C</p></td>
<td><p>6</p></td>
<td><p>4</p></td>
<td><p>Beta(7,5)</p></td>
</tr>
<tr class="row-odd"><td><p>D</p></td>
<td><p>1</p></td>
<td><p>2</p></td>
<td><p>Beta(2,3)</p></td>
</tr>
<tr class="row-even"><td><p>E</p></td>
<td><p>10</p></td>
<td><p>20</p></td>
<td><p>Beta(11,21)</p></td>
</tr>
</tbody>
</table>
<p>Next block show the posterior distribution and also the lower bound of the <span class="math notranslate nohighlight">\(95 \%\)</span> confidence interval.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="k">import</span> <span class="n">beta</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">movies_arr</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">40</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span>
               <span class="p">];</span>

<span class="n">movies</span><span class="o">=</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;up&#39;</span><span class="p">,</span><span class="s1">&#39;down&#39;</span><span class="p">],</span> <span class="n">a</span><span class="p">))</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">movies_arr</span><span class="p">]</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1001</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>


<span class="c1"># Prior information, movies tend to be more average and less extreme</span>
<span class="n">a0</span><span class="p">,</span> <span class="n">b0</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">movies</span><span class="p">)):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">movies</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;up&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">a0</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">movies</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;down&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">a0</span>
    <span class="n">b1</span> <span class="o">=</span> <span class="n">beta</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

    <span class="n">p</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{movies[i][&#39;name&#39;]}</span><span class="s2">  </span><span class="si">{movies[i][&#39;up&#39;]}</span><span class="s2">:</span><span class="si">{movies[i][&#39;down&#39;]}</span><span class="s2">&quot;</span> <span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

    <span class="n">rank</span> <span class="o">=</span> <span class="n">beta</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">rank</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_color</span><span class="p">(),</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{movies[i][&#39;name&#39;]}</span><span class="s2">  </span><span class="si">{movies[i][&#39;up&#39;]}</span><span class="s2">:</span><span class="si">{movies[i][&#39;down&#39;]}</span><span class="s2"> rank: </span><span class="si">{rank:0.2f}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">axes</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">a0</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>A  60:40 rank: 0.52
B  6:1 rank: 0.53
C  6:4 rank: 0.35
D  1:2 rank: 0.10
E  10:20 rank: 0.21
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7f77be803510&gt;
</pre></div>
</div>
<img alt="../_images/Example Ratings_6_2.png" src="../_images/Example Ratings_6_2.png" />
</div>
</div>
<p>This separates the high evidence A (60:40) and low evidence C (6:4) movies but isn’t an ideal ranking overall, particularly for D (red) which has very little evidence yet receives the worst ranking.</p>
</div>
<div class="section" id="posterior-from-prio-2">
<h3>Posterior from  Prio 2<a class="headerlink" href="#posterior-from-prio-2" title="Permalink to this headline">¶</a></h3>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>product id</p></th>
<th class="head"><p>up</p></th>
<th class="head"><p>down</p></th>
<th class="head"><p>Posterior</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>A</p></td>
<td><p>60</p></td>
<td><p>40</p></td>
<td><p>Beta(71,51)</p></td>
</tr>
<tr class="row-odd"><td><p>B</p></td>
<td><p>6</p></td>
<td><p>1</p></td>
<td><p>Beta(17,12)</p></td>
</tr>
<tr class="row-even"><td><p>C</p></td>
<td><p>6</p></td>
<td><p>4</p></td>
<td><p>Beta(17,15)</p></td>
</tr>
<tr class="row-odd"><td><p>D</p></td>
<td><p>1</p></td>
<td><p>2</p></td>
<td><p>Beta(12,13)</p></td>
</tr>
<tr class="row-even"><td><p>E</p></td>
<td><p>10</p></td>
<td><p>20</p></td>
<td><p>Beta(21,31)</p></td>
</tr>
</tbody>
</table>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="k">import</span> <span class="n">beta</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">movies_arr</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">40</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span>
               <span class="p">];</span>

<span class="n">movies</span><span class="o">=</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;up&#39;</span><span class="p">,</span><span class="s1">&#39;down&#39;</span><span class="p">],</span> <span class="n">a</span><span class="p">))</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">movies_arr</span><span class="p">]</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1001</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>


<span class="c1"># Prior information, movies tend to be more average and less extreme</span>
<span class="n">a0</span><span class="p">,</span> <span class="n">b0</span> <span class="o">=</span> <span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="mi">11</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">movies</span><span class="p">)):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">movies</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;up&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">a0</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">movies</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;down&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">a0</span>
    <span class="n">b1</span> <span class="o">=</span> <span class="n">beta</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

    <span class="n">p</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{movies[i][&#39;name&#39;]}</span><span class="s2">  </span><span class="si">{movies[i][&#39;up&#39;]}</span><span class="s2">:</span><span class="si">{movies[i][&#39;down&#39;]}</span><span class="s2">&quot;</span> <span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

    <span class="n">rank</span> <span class="o">=</span> <span class="n">beta</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">rank</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_color</span><span class="p">(),</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{movies[i][&#39;name&#39;]}</span><span class="s2">  </span><span class="si">{movies[i][&#39;up&#39;]}</span><span class="s2">:</span><span class="si">{movies[i][&#39;down&#39;]}</span><span class="s2"> rank: </span><span class="si">{rank:0.2f}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">if</span> <span class="n">a0</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>A  60:40 rank: 0.51
B  6:1 rank: 0.43
C  6:4 rank: 0.39
D  1:2 rank: 0.32
E  10:20 rank: 0.30
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7f77be078110&gt;
</pre></div>
</div>
<img alt="../_images/Example Ratings_9_2.png" src="../_images/Example Ratings_9_2.png" />
</div>
</div>
<p>Result is showing that the low evidence D curve is roughly in the middle while the E curve with significantly more negative evidence now has the lowest rank</p>
</div>
<div class="section" id="posterior-from-prio-3">
<h3>Posterior from  Prio 3<a class="headerlink" href="#posterior-from-prio-3" title="Permalink to this headline">¶</a></h3>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>product id</p></th>
<th class="head"><p>up</p></th>
<th class="head"><p>down</p></th>
<th class="head"><p>Posterior</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>A</p></td>
<td><p>60</p></td>
<td><p>40</p></td>
<td><p>Beta(80,41)</p></td>
</tr>
<tr class="row-odd"><td><p>B</p></td>
<td><p>6</p></td>
<td><p>1</p></td>
<td><p>Beta(26,2)</p></td>
</tr>
<tr class="row-even"><td><p>C</p></td>
<td><p>6</p></td>
<td><p>4</p></td>
<td><p>Beta(26,5)</p></td>
</tr>
<tr class="row-odd"><td><p>D</p></td>
<td><p>1</p></td>
<td><p>2</p></td>
<td><p>Beta(21,3)</p></td>
</tr>
<tr class="row-even"><td><p>E</p></td>
<td><p>10</p></td>
<td><p>20</p></td>
<td><p>Beta(30,21)</p></td>
</tr>
</tbody>
</table>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="k">import</span> <span class="n">beta</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">movies_arr</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">40</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span>
               <span class="p">];</span>

<span class="n">movies</span><span class="o">=</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;up&#39;</span><span class="p">,</span><span class="s1">&#39;down&#39;</span><span class="p">],</span> <span class="n">a</span><span class="p">))</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">movies_arr</span><span class="p">]</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1001</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>


<span class="c1"># Prior information, movies tend to be more average and less extreme</span>
<span class="n">a0</span><span class="p">,</span> <span class="n">b0</span> <span class="o">=</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">movies</span><span class="p">)):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">movies</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;up&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">a0</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">movies</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;down&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">a0</span>
    <span class="n">b1</span> <span class="o">=</span> <span class="n">beta</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

    <span class="n">p</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{movies[i][&#39;name&#39;]}</span><span class="s2">  </span><span class="si">{movies[i][&#39;up&#39;]}</span><span class="s2">:</span><span class="si">{movies[i][&#39;down&#39;]}</span><span class="s2">&quot;</span> <span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

    <span class="n">rank</span> <span class="o">=</span> <span class="n">beta</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">rank</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_color</span><span class="p">(),</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{movies[i][&#39;name&#39;]}</span><span class="s2">  </span><span class="si">{movies[i][&#39;up&#39;]}</span><span class="s2">:</span><span class="si">{movies[i][&#39;down&#39;]}</span><span class="s2"> rank: </span><span class="si">{rank:0.2f}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">if</span> <span class="n">a0</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>A  60:40 rank: 0.50
B  6:1 rank: 0.43
C  6:4 rank: 0.40
D  1:2 rank: 0.36
E  10:20 rank: 0.33
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7f77be02a290&gt;
</pre></div>
</div>
<img alt="../_images/Example Ratings_12_2.png" src="../_images/Example Ratings_12_2.png" />
</div>
</div>
</div>
</div>
<div class="section" id="section2-from-binary-to-multirating">
<h2>Section2: From binary to multirating<a class="headerlink" href="#section2-from-binary-to-multirating" title="Permalink to this headline">¶</a></h2>
<p>We can complicate the binary system of up-down votes to a 5 star system by rating each star with a different weigth like below:</p>
<p>Stars (1,2,3,4,5): up (0,0.25,0.5,0.75,1) down (1,0.75,0.5,0.25,0).</p>
<p>In other words:
For each:</p>
<ul class="simple">
<li><p>‘*’ (one star) we sum the up with 0 (up=up+0), we sum the down with 1 (down=down+1)</p></li>
<li><p>‘**’ (two stars) we sum the up with 0.25 (up=up+0.25), we sum the down with 0.75 (down=down+0.75)</p></li>
<li><p>‘***’ (three stars) we sum the up with 0.5 (up=up+0.5), we sum the down with 0.5 (down=down+0.5)</p></li>
<li><p>‘****’ (four stars) we sum the up with 0.75 (up=up+0.75), we sum the down with 0.25 (down=down+0.25)</p></li>
<li><p>‘*****’ (five stars) we sum the up with 1 (up=up+1), we sum the down with 0.  (down=down+0.)</p></li>
</ul>
<p>For example: we want to compare 2 products</p>
<ul class="simple">
<li><p>product 1: received 6 * 5-stars reviews</p></li>
<li><p>product 2: received 20 * 4-stars reviews and 5 * 5-stars reviews</p></li>
</ul>
<p>Applying the scaling above to reconduct to a bynary system of two levels of up and down values:</p>
<ul class="simple">
<li><p>product 1: Up= 6 * 1=6 , Down =0 * 5=0</p></li>
<li><p>product 2: Up= 20 * 0.75 + 5 * 1=20 , Down = 20 * 0.25+5 * 0=5</p></li>
</ul>
<p>Let’s start with the prior centred on average value 3:</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="k">import</span> <span class="n">beta</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1001</span><span class="p">)</span>
<span class="n">b1</span> <span class="o">=</span> <span class="n">beta</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="mi">4</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span> <span class="c1">#note: to shift for 0-1 to 1-5 we multiplied by the factor *4+1 the x</span>
<span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;Prior beta(20,20)&quot;</span> <span class="p">)</span>
<span class="n">axes</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="mi">4</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

<span class="n">b2</span> <span class="o">=</span> <span class="n">beta</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="mi">4</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;Product 1&quot;</span> <span class="p">)</span>
<span class="n">axes</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="mi">4</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">rank</span> <span class="o">=</span> <span class="n">beta</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span><span class="mi">21</span><span class="p">)</span><span class="o">*</span><span class="mi">4</span><span class="o">+</span><span class="mi">1</span>
<span class="n">axes</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">rank</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_color</span><span class="p">(),</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>



<span class="n">b3</span> <span class="o">=</span> <span class="n">beta</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span><span class="mi">25</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="mi">4</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">b3</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;Product 2&quot;</span> <span class="p">)</span>
<span class="n">axes</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="mi">4</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">b3</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">rank</span> <span class="o">=</span> <span class="n">beta</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mi">41</span><span class="p">,</span><span class="mi">26</span><span class="p">)</span><span class="o">*</span><span class="mi">4</span><span class="o">+</span><span class="mi">1</span>
<span class="n">axes</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">rank</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_color</span><span class="p">(),</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">axes</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">5.</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Prior &amp; Posterior Distributions&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7f77bdf07d50&gt;
</pre></div>
</div>
<img alt="../_images/Example Ratings_16_1.png" src="../_images/Example Ratings_16_1.png" />
</div>
</div>
<p>As we can see from the previous graph, starting with the prior centrated on the average, the posterior of product 2 is greater than the product 1 and also the rating based on the  lower bound of the  95%  predictive interval</p>
<p>Let’s try what is the output starting from the prior uniform distribution:</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="k">import</span> <span class="n">beta</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1001</span><span class="p">)</span>
<span class="n">b1</span> <span class="o">=</span> <span class="n">beta</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="mi">4</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;Prior beta(1,1)&quot;</span> <span class="p">)</span>
<span class="n">axes</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="mi">4</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

<span class="n">b2</span> <span class="o">=</span> <span class="n">beta</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="mi">4</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;Product 1&quot;</span> <span class="p">)</span>
<span class="n">axes</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="mi">4</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">rank</span> <span class="o">=</span> <span class="n">beta</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">4</span><span class="o">+</span><span class="mi">1</span>
<span class="n">axes</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">rank</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_color</span><span class="p">(),</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">b3</span> <span class="o">=</span> <span class="n">beta</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="mi">4</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">b3</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;Product 2&quot;</span> <span class="p">)</span>
<span class="n">axes</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="mi">4</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">b3</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">rank</span> <span class="o">=</span> <span class="n">beta</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span><span class="o">*</span><span class="mi">4</span><span class="o">+</span><span class="mi">1</span>
<span class="n">axes</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">rank</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_color</span><span class="p">(),</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">axes</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span><span class="mf">5.</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Prior &amp; Posterior Distributions&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7f77bde9db10&gt;
</pre></div>
</div>
<img alt="../_images/Example Ratings_18_1.png" src="../_images/Example Ratings_18_1.png" />
</div>
</div>
<p>In this case the posterior of product 1 seems to be higher than the posterior of product 2. However it has also a long tail, this impact the lower bound for the 95% of the predictive level that also in this case is higher for the product 2.</p>
<p>With both choises of the prior, the product 2 will have a higher rating than the product 1.</p>
<div class="admonition-important admonition">
<p class="admonition-title"><strong>Important</strong></p>
<p>One great insight that we can extract from the bayesian approach, differently from the frequentist approach, is not only to know if a variant is better with respect the other and the predictive interval of this, but also to quantify how much a product is better than the other ( or better: the probability than a product A will receive higher evaluations respect to the product B).</p>
<p>Think to AB test: would be great to monitor daily the Probability that a version A is better than version B and compute the loss by proceeding the test rather just simply waiting that the pvalue is enough to determine the end of the test?</p>
</div>
<p>In the next section we will compute the joint probability between the posterior of product 1 and product 2 and see how much the product 2 is greater than product 1:</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy</span> <span class="k">import</span> <span class="n">stats</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.gridspec</span> <span class="k">as</span> <span class="nn">gridspec</span>

<span class="k">def</span> <span class="nf">jointplot</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Tool function to create a 3 part grid plot.&quot;&quot;&quot;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
    <span class="n">gs0</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=.</span><span class="mi">02</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=.</span><span class="mi">02</span><span class="p">)</span>
    <span class="n">ax1</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs0</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs0</span><span class="p">[:</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">ax3</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs0</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">:])</span>
    <span class="k">return</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span>

<span class="n">a_1</span><span class="p">,</span> <span class="n">b_1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">26</span><span class="p">,</span><span class="mi">21</span><span class="p">)</span>
<span class="n">a_2</span><span class="p">,</span> <span class="n">b_2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">40</span><span class="p">,</span><span class="mi">25</span><span class="p">)</span>

<span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1000</span><span class="p">))</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">beta</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">y_1</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">beta</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a_1</span><span class="p">,</span> <span class="n">b_1</span><span class="p">)</span>
<span class="n">y_2</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">beta</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a_2</span><span class="p">,</span> <span class="n">b_2</span><span class="p">)</span>

<span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">y_1</span><span class="p">,</span> <span class="n">y_2</span><span class="p">)</span>
<span class="n">Z</span> <span class="o">=</span> <span class="n">X</span> <span class="o">*</span> <span class="n">Y</span>

<span class="c1"># PLOT</span>
<span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span> <span class="o">=</span> <span class="n">jointplot</span><span class="p">()</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span> <span class="s1">&#39;Blues&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Product1= Product2&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y_1</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y_2</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Product1&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Product2&#39;</span><span class="p">)</span>

<span class="n">ax3</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/Example Ratings_20_0.png" src="../_images/Example Ratings_20_0.png" />
</div>
</div>
<p>We can see that the posterior of product 2 is higher than the posterior of product 1. All the area above the orange line represents how much the two posteriors are different. Let’s quantify this area:</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#compute the area above the orange line by mean of monte carlo random sampling</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">100000</span>

<span class="n">mean_1</span><span class="p">,</span> <span class="n">var_1</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">beta</span><span class="o">.</span><span class="n">stats</span><span class="p">(</span><span class="n">a_1</span><span class="p">,</span> <span class="n">b_1</span><span class="p">,</span> <span class="n">moments</span><span class="o">=</span><span class="s1">&#39;mv&#39;</span><span class="p">)</span>
<span class="n">mean_2</span><span class="p">,</span> <span class="n">var_2</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">beta</span><span class="o">.</span><span class="n">stats</span><span class="p">(</span><span class="n">a_2</span><span class="p">,</span> <span class="n">b_2</span><span class="p">,</span> <span class="n">moments</span><span class="o">=</span><span class="s1">&#39;mv&#39;</span><span class="p">)</span>

<span class="n">randx_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">mean_1</span><span class="p">,</span> <span class="mf">1.25</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var_1</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="n">N</span><span class="p">)</span>
<span class="n">randx_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">mean_2</span><span class="p">,</span> <span class="mf">1.25</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var_2</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="n">N</span><span class="p">)</span>

<span class="n">y_1</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">beta</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">randx_1</span><span class="p">,</span> <span class="n">a_1</span><span class="p">,</span> <span class="n">b_1</span><span class="p">)</span>
<span class="n">y_2</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">beta</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">randx_2</span><span class="p">,</span> <span class="n">a_2</span><span class="p">,</span> <span class="n">b_2</span><span class="p">)</span>

<span class="n">g_1</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">randx_1</span><span class="p">,</span> <span class="n">mean_1</span><span class="p">,</span> <span class="mf">1.25</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var_1</span><span class="p">))</span>
<span class="n">g_2</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">randx_2</span><span class="p">,</span> <span class="n">mean_2</span><span class="p">,</span> <span class="mf">1.25</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var_2</span><span class="p">))</span>

<span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_1</span> <span class="o">*</span> <span class="n">y_2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">g_1</span> <span class="o">*</span> <span class="n">g_2</span><span class="p">)</span>

<span class="n">b_better_a_x</span> <span class="o">=</span> <span class="n">randx_1</span> <span class="o">&lt;=</span> <span class="n">randx_2</span>
<span class="n">b_better_a_z</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="n">b_better_a_x</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Integral value:  {1*b_better_a_z.sum()/N}&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Calculation error: {np.sqrt(1*(b_better_a_z*b_better_a_z).sum()/N - (1*b_better_a_z.sum()/N)**2)/np.sqrt(N)}&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Integral value:  0.7451894041611561
Calculation error: 0.0018366004750940037
</pre></div>
</div>
</div>
</div>
<p>The previous results show that there is 75<span class="math notranslate nohighlight">\(\%\)</span> of proability that the product 2 will be better evaluated than the product 2.</p>
<p>Remember: Choose your prior according to your knowledge! It can affect the outcome.</p>
<p>And furthermore: You could miss out on some really great new products with the disadvantage of being new and not properly reviewed. Choose your own risk you want to take, maybe it is okay for you to be wrong 20% of the time?</p>
</div>
<div class="section" id="section3-the-real-case-rating-for-the-buyers-and-sellers">
<h2>Section3: The real case: rating for the buyers and sellers<a class="headerlink" href="#section3-the-real-case-rating-for-the-buyers-and-sellers" title="Permalink to this headline">¶</a></h2>
<p>Let’s replicate the previous approach for a real case of dataset coming from the rating received by buyers and sellers during a timeframe of almost 1 month and half.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">Counter</span>
<span class="kn">from</span> <span class="nn">operator</span> <span class="k">import</span> <span class="n">itemgetter</span>

<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="k">import</span> <span class="n">display</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="s1">&#39;../../datasets-toys/datasets/rating_per_user.json&#39;</span><span class="p">,</span> <span class="n">lines</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ratingType</th>
      <th>ratings</th>
      <th>ratings_date</th>
      <th>nof_reviews</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>SellerToBuyer</td>
      <td>[5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, ...</td>
      <td>[2021-01-27, 2021-01-13, 2021-01-13, 2021-02-0...</td>
      <td>86</td>
    </tr>
    <tr>
      <th>1</th>
      <td>BuyerToSeller</td>
      <td>[5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, ...</td>
      <td>[2021-01-09, 2021-01-09, 2021-01-09, 2021-01-0...</td>
      <td>85</td>
    </tr>
    <tr>
      <th>2</th>
      <td>BuyerToSeller</td>
      <td>[5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, ...</td>
      <td>[2021-01-01, 2021-01-01, 2021-01-20, 2021-01-2...</td>
      <td>29</td>
    </tr>
    <tr>
      <th>3</th>
      <td>SellerToBuyer</td>
      <td>[5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, ...</td>
      <td>[2021-01-31, 2021-01-31, 2021-01-31, 2021-01-1...</td>
      <td>28</td>
    </tr>
    <tr>
      <th>4</th>
      <td>BuyerToSeller</td>
      <td>[5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, ...</td>
      <td>[2021-01-22, 2021-01-22, 2021-01-22, 2021-01-2...</td>
      <td>24</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>nof_reviews</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>206396.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>1.038431</td>
    </tr>
    <tr>
      <th>std</th>
      <td>0.435590</td>
    </tr>
    <tr>
      <th>min</th>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>86.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Number_of_date&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">ratings_date</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="p">)</span>

<span class="n">data</span><span class="p">[</span><span class="s1">&#39;Number_of_5&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">ratings</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;Number_of_4&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">ratings</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;Number_of_3&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">ratings</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;Number_of_2&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">ratings</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;Number_of_1&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">ratings</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">)</span>

<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ratingType</th>
      <th>ratings</th>
      <th>ratings_date</th>
      <th>nof_reviews</th>
      <th>Number_of_date</th>
      <th>Number_of_5</th>
      <th>Number_of_4</th>
      <th>Number_of_3</th>
      <th>Number_of_2</th>
      <th>Number_of_1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>SellerToBuyer</td>
      <td>[5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, ...</td>
      <td>[2021-01-27, 2021-01-13, 2021-01-13, 2021-02-0...</td>
      <td>86</td>
      <td>15</td>
      <td>86</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>BuyerToSeller</td>
      <td>[5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, ...</td>
      <td>[2021-01-09, 2021-01-09, 2021-01-09, 2021-01-0...</td>
      <td>85</td>
      <td>19</td>
      <td>85</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>BuyerToSeller</td>
      <td>[5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, ...</td>
      <td>[2021-01-01, 2021-01-01, 2021-01-20, 2021-01-2...</td>
      <td>29</td>
      <td>13</td>
      <td>29</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>SellerToBuyer</td>
      <td>[5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, ...</td>
      <td>[2021-01-31, 2021-01-31, 2021-01-31, 2021-01-1...</td>
      <td>28</td>
      <td>11</td>
      <td>28</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>BuyerToSeller</td>
      <td>[5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, ...</td>
      <td>[2021-01-22, 2021-01-22, 2021-01-22, 2021-01-2...</td>
      <td>24</td>
      <td>7</td>
      <td>24</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;average_star&#39;</span><span class="p">]</span><span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Number_of_5&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span><span class="o">+</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Number_of_4&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">4</span><span class="o">+</span>
                       <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Number_of_3&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span><span class="o">+</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Number_of_2&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Number_of_1&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;nof_reviews&#39;</span><span class="p">]</span>
<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ratingType</th>
      <th>ratings</th>
      <th>ratings_date</th>
      <th>nof_reviews</th>
      <th>Number_of_date</th>
      <th>Number_of_5</th>
      <th>Number_of_4</th>
      <th>Number_of_3</th>
      <th>Number_of_2</th>
      <th>Number_of_1</th>
      <th>average_star</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>SellerToBuyer</td>
      <td>[5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, ...</td>
      <td>[2021-01-27, 2021-01-13, 2021-01-13, 2021-02-0...</td>
      <td>86</td>
      <td>15</td>
      <td>86</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>BuyerToSeller</td>
      <td>[5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, ...</td>
      <td>[2021-01-09, 2021-01-09, 2021-01-09, 2021-01-0...</td>
      <td>85</td>
      <td>19</td>
      <td>85</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>BuyerToSeller</td>
      <td>[5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, ...</td>
      <td>[2021-01-01, 2021-01-01, 2021-01-20, 2021-01-2...</td>
      <td>29</td>
      <td>13</td>
      <td>29</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>SellerToBuyer</td>
      <td>[5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, ...</td>
      <td>[2021-01-31, 2021-01-31, 2021-01-31, 2021-01-1...</td>
      <td>28</td>
      <td>11</td>
      <td>28</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>BuyerToSeller</td>
      <td>[5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, ...</td>
      <td>[2021-01-22, 2021-01-22, 2021-01-22, 2021-01-2...</td>
      <td>24</td>
      <td>7</td>
      <td>24</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;average_star&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5.000000    196005
4.000000      6117
1.000000      2299
3.000000      1413
2.000000       489
4.500000        40
3.500000         9
4.666667         7
2.500000         3
4.333333         3
3.666667         3
1.666667         2
1.500000         1
1.250000         1
2.333333         1
4.833333         1
2.800000         1
4.555556         1
Name: average_star, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">func_sum</span><span class="p">(</span><span class="n">group</span><span class="p">):</span>
    <span class="n">sum_group</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">sum_group</span><span class="p">],</span>
                     <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;sum_group&#39;</span><span class="p">])</span>

<span class="n">df_overview</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;ratingType&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">func_sum</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="n">df_overview</span><span class="p">[</span><span class="s1">&#39;ratio%&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">df_overview</span><span class="p">[</span><span class="s1">&#39;sum_group&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">df_overview</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ratingType</th>
      <th>sum_group</th>
      <th>ratio%</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>BuyerToSeller</td>
      <td>81844</td>
      <td>39.65</td>
    </tr>
    <tr>
      <th>1</th>
      <td>SellerToBuyer</td>
      <td>124552</td>
      <td>60.35</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Let’s start by a classification given by the average of ratings splitting the two cathegories:</p>
<div class="section" id="group-buyer-and-seller-and-classifies-by-mean-of-average">
<h3>Group buyer and seller and classifies by mean of average<a class="headerlink" href="#group-buyer-and-seller-and-classifies-by-mean-of-average" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Sellers</span><span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ratingType&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;BuyerToSeller&#39;</span><span class="p">]</span>
<span class="n">display</span><span class="p">(</span><span class="n">Sellers</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span> <span class="s1">&#39;average_star&#39;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="kc">False</span><span class="p">])</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>

<span class="n">display</span><span class="p">(</span><span class="n">Sellers</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">Sellers</span><span class="p">[</span><span class="s1">&#39;nof_reviews&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">Sellers</span><span class="o">.</span><span class="n">nof_reviews</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ratingType</th>
      <th>ratings</th>
      <th>ratings_date</th>
      <th>nof_reviews</th>
      <th>Number_of_date</th>
      <th>Number_of_5</th>
      <th>Number_of_4</th>
      <th>Number_of_3</th>
      <th>Number_of_2</th>
      <th>Number_of_1</th>
      <th>average_star</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>BuyerToSeller</td>
      <td>[5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, ...</td>
      <td>[2021-01-09, 2021-01-09, 2021-01-09, 2021-01-0...</td>
      <td>85</td>
      <td>19</td>
      <td>85</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>136004</th>
      <td>BuyerToSeller</td>
      <td>[5.0]</td>
      <td>[2021-01-30]</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>136012</th>
      <td>BuyerToSeller</td>
      <td>[5.0]</td>
      <td>[2021-01-03]</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>136011</th>
      <td>BuyerToSeller</td>
      <td>[5.0]</td>
      <td>[2021-01-06]</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>136009</th>
      <td>BuyerToSeller</td>
      <td>[5.0]</td>
      <td>[2021-01-06]</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>136008</th>
      <td>BuyerToSeller</td>
      <td>[5.0]</td>
      <td>[2021-01-09]</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>136007</th>
      <td>BuyerToSeller</td>
      <td>[5.0]</td>
      <td>[2021-01-08]</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>136006</th>
      <td>BuyerToSeller</td>
      <td>[5.0]</td>
      <td>[2021-02-01]</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>136005</th>
      <td>BuyerToSeller</td>
      <td>[5.0]</td>
      <td>[2021-01-07]</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>136003</th>
      <td>BuyerToSeller</td>
      <td>[5.0]</td>
      <td>[2021-01-25]</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5.0</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ratingType</th>
      <th>ratings</th>
      <th>ratings_date</th>
      <th>nof_reviews</th>
      <th>Number_of_date</th>
      <th>Number_of_5</th>
      <th>Number_of_4</th>
      <th>Number_of_3</th>
      <th>Number_of_2</th>
      <th>Number_of_1</th>
      <th>average_star</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>BuyerToSeller</td>
      <td>[5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, ...</td>
      <td>[2021-01-09, 2021-01-09, 2021-01-09, 2021-01-0...</td>
      <td>85</td>
      <td>19</td>
      <td>85</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Bayers</span><span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ratingType&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;SellerToBuyer&#39;</span><span class="p">]</span>
<span class="n">display</span><span class="p">(</span><span class="n">Bayers</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s1">&#39;average_star&#39;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="kc">False</span><span class="p">])</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>

<span class="n">display</span><span class="p">(</span><span class="n">Bayers</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">Bayers</span><span class="p">[</span><span class="s1">&#39;nof_reviews&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">Bayers</span><span class="o">.</span><span class="n">nof_reviews</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ratingType</th>
      <th>ratings</th>
      <th>ratings_date</th>
      <th>nof_reviews</th>
      <th>Number_of_date</th>
      <th>Number_of_5</th>
      <th>Number_of_4</th>
      <th>Number_of_3</th>
      <th>Number_of_2</th>
      <th>Number_of_1</th>
      <th>average_star</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>SellerToBuyer</td>
      <td>[5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, ...</td>
      <td>[2021-01-27, 2021-01-13, 2021-01-13, 2021-02-0...</td>
      <td>86</td>
      <td>15</td>
      <td>86</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>135754</th>
      <td>SellerToBuyer</td>
      <td>[5.0]</td>
      <td>[2021-01-17]</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>135766</th>
      <td>SellerToBuyer</td>
      <td>[5.0]</td>
      <td>[2021-02-07]</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>135765</th>
      <td>SellerToBuyer</td>
      <td>[5.0]</td>
      <td>[2021-01-15]</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>135764</th>
      <td>SellerToBuyer</td>
      <td>[5.0]</td>
      <td>[2021-01-11]</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>135763</th>
      <td>SellerToBuyer</td>
      <td>[5.0]</td>
      <td>[2021-02-11]</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>135762</th>
      <td>SellerToBuyer</td>
      <td>[5.0]</td>
      <td>[2021-02-05]</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>135761</th>
      <td>SellerToBuyer</td>
      <td>[5.0]</td>
      <td>[2021-01-22]</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>135760</th>
      <td>SellerToBuyer</td>
      <td>[5.0]</td>
      <td>[2021-01-27]</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>135759</th>
      <td>SellerToBuyer</td>
      <td>[5.0]</td>
      <td>[2021-01-09]</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5.0</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ratingType</th>
      <th>ratings</th>
      <th>ratings_date</th>
      <th>nof_reviews</th>
      <th>Number_of_date</th>
      <th>Number_of_5</th>
      <th>Number_of_4</th>
      <th>Number_of_3</th>
      <th>Number_of_2</th>
      <th>Number_of_1</th>
      <th>average_star</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>SellerToBuyer</td>
      <td>[5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, ...</td>
      <td>[2021-01-27, 2021-01-13, 2021-01-13, 2021-02-0...</td>
      <td>86</td>
      <td>15</td>
      <td>86</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>It is quickly apparent that there is a problem with our current approach. Reviews with high average ratings but very few reviewers are listed first.</p>
<p>In order to get a feel for our data, let’s visually compare the mean rating to the counts.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_mean_frequency</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;nof_reviews&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;average_star&#39;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;hexbin&#39;</span><span class="p">,</span>
                   <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;YlGnBu&#39;</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">gridsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">mincnt</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                  <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Star Ratings by Simple Mean for Buyer&quot;</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;#of ratings&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;average of stars&#39;</span><span class="p">)</span>
    
<span class="n">plot_mean_frequency</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ratingType&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;SellerToBuyer&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/Example Ratings_39_0.png" src="../_images/Example Ratings_39_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_mean_frequency</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;nof_reviews&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;average_star&#39;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;hexbin&#39;</span><span class="p">,</span>
                   <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;YlGnBu&#39;</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">gridsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">mincnt</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                  <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Star Ratings by Simple Mean for Seller&quot;</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;#of ratings&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;average of stars&#39;</span><span class="p">)</span>
    
<span class="n">plot_mean_frequency</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ratingType&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;BuyerToSeller&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/Example Ratings_40_0.png" src="../_images/Example Ratings_40_0.png" />
</div>
</div>
<p>This figure shows that the average rating of a movie is actually slightly higher than 3. There is a strong cluster of Buyer and Seller with less than 10 reviewers whose simple mean rating surrounds 3.5. This contrasts with the rigth side of the figure, where you can clearly see that the mean is 5 when there are more reviewers.
The figure visually calls our attention to a problem. When there are less than 10 reviewers, there are dramatic tails that ensure equally high and low reviews. If there are less than 10 reviews, the probability is much higher that a Buyer/Seller will have an average rating of 1.0, whereas after 10 reviews, the figure shows that it is extremely unlikely to see a movie with an average rating different from 5.
We can hypothesize two things from this plot that allow us to make decisions for our specific data set. First, we become confident that a mean rating is good so long as it has more than 10 reviews. Secondly, we know that the average review is around overall 4. Using these two hypotheses, we can come up with a rule that will allow us to rank seller/buyer according to both the mean rating the movie has received as well as the number of reviewers that have reviewed it and can help to choise a prior distribution.</p>
</div>
</div>
<div class="section" id="bayesian-rating">
<h2>Bayesian rating<a class="headerlink" href="#bayesian-rating" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># let&#39;s compute </span>
<span class="c1">#the up and down vote with the scaling:</span>
<span class="c1">#up (0,0.25,0.5,0.75,1) down (1,0.75,0.5,0.25,0)</span>
    
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;Up_vote&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Number_of_1&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">0</span><span class="o">+</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Number_of_2&#39;</span><span class="p">]</span><span class="o">*</span><span class="mf">0.25</span><span class="o">+</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Number_of_3&#39;</span><span class="p">]</span><span class="o">*</span><span class="mf">0.5</span><span class="o">+</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Number_of_4&#39;</span><span class="p">]</span><span class="o">*</span><span class="mf">0.75</span><span class="o">+</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Number_of_5&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">1</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;Down_vote&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Number_of_1&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">1</span><span class="o">+</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Number_of_2&#39;</span><span class="p">]</span><span class="o">*</span><span class="mf">0.75</span><span class="o">+</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Number_of_3&#39;</span><span class="p">]</span><span class="o">*</span><span class="mf">0.5</span><span class="o">+</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Number_of_4&#39;</span><span class="p">]</span><span class="o">*</span><span class="mf">0.25</span><span class="o">+</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Number_of_5&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">0</span>

<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ratingType</th>
      <th>ratings</th>
      <th>ratings_date</th>
      <th>nof_reviews</th>
      <th>Number_of_date</th>
      <th>Number_of_5</th>
      <th>Number_of_4</th>
      <th>Number_of_3</th>
      <th>Number_of_2</th>
      <th>Number_of_1</th>
      <th>average_star</th>
      <th>Up_vote</th>
      <th>Down_vote</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>SellerToBuyer</td>
      <td>[5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, ...</td>
      <td>[2021-01-27, 2021-01-13, 2021-01-13, 2021-02-0...</td>
      <td>86</td>
      <td>15</td>
      <td>86</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5.0</td>
      <td>86.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>BuyerToSeller</td>
      <td>[5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, ...</td>
      <td>[2021-01-09, 2021-01-09, 2021-01-09, 2021-01-0...</td>
      <td>85</td>
      <td>19</td>
      <td>85</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5.0</td>
      <td>85.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>BuyerToSeller</td>
      <td>[5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, ...</td>
      <td>[2021-01-01, 2021-01-01, 2021-01-20, 2021-01-2...</td>
      <td>29</td>
      <td>13</td>
      <td>29</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5.0</td>
      <td>29.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>SellerToBuyer</td>
      <td>[5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, ...</td>
      <td>[2021-01-31, 2021-01-31, 2021-01-31, 2021-01-1...</td>
      <td>28</td>
      <td>11</td>
      <td>28</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5.0</td>
      <td>28.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>BuyerToSeller</td>
      <td>[5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, ...</td>
      <td>[2021-01-22, 2021-01-22, 2021-01-22, 2021-01-2...</td>
      <td>24</td>
      <td>7</td>
      <td>24</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5.0</td>
      <td>24.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#computing the lower 95%</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;rank&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">beta</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Up_vote&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">11</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Down_vote&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">11</span><span class="p">)</span><span class="o">*</span><span class="mi">4</span><span class="o">+</span><span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">buyer</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ratingType&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;SellerToBuyer&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;rank&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">buyer</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ratingType</th>
      <th>ratings</th>
      <th>ratings_date</th>
      <th>nof_reviews</th>
      <th>Number_of_date</th>
      <th>Number_of_5</th>
      <th>Number_of_4</th>
      <th>Number_of_3</th>
      <th>Number_of_2</th>
      <th>Number_of_1</th>
      <th>average_star</th>
      <th>Up_vote</th>
      <th>Down_vote</th>
      <th>rank</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>SellerToBuyer</td>
      <td>[5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, ...</td>
      <td>[2021-01-27, 2021-01-13, 2021-01-13, 2021-02-0...</td>
      <td>86</td>
      <td>15</td>
      <td>86</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5.0</td>
      <td>86.0</td>
      <td>0.0</td>
      <td>4.386527</td>
    </tr>
    <tr>
      <th>3</th>
      <td>SellerToBuyer</td>
      <td>[5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, ...</td>
      <td>[2021-01-31, 2021-01-31, 2021-01-31, 2021-01-1...</td>
      <td>28</td>
      <td>11</td>
      <td>28</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5.0</td>
      <td>28.0</td>
      <td>0.0</td>
      <td>3.713831</td>
    </tr>
    <tr>
      <th>5</th>
      <td>SellerToBuyer</td>
      <td>[5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, ...</td>
      <td>[2021-01-28, 2021-01-19, 2021-01-19, 2021-01-1...</td>
      <td>24</td>
      <td>8</td>
      <td>24</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5.0</td>
      <td>24.0</td>
      <td>0.0</td>
      <td>3.609086</td>
    </tr>
    <tr>
      <th>7</th>
      <td>SellerToBuyer</td>
      <td>[5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, ...</td>
      <td>[2021-01-25, 2021-02-08, 2021-02-08, 2021-01-2...</td>
      <td>23</td>
      <td>12</td>
      <td>23</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5.0</td>
      <td>23.0</td>
      <td>0.0</td>
      <td>3.580205</td>
    </tr>
    <tr>
      <th>8</th>
      <td>SellerToBuyer</td>
      <td>[5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, ...</td>
      <td>[2021-01-10, 2021-01-19, 2021-01-15, 2021-01-1...</td>
      <td>22</td>
      <td>7</td>
      <td>22</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5.0</td>
      <td>22.0</td>
      <td>0.0</td>
      <td>3.550112</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>147</th>
      <td>SellerToBuyer</td>
      <td>[5.0, 5.0, 5.0, 5.0, 5.0, 5.0]</td>
      <td>[2021-01-28, 2021-01-28, 2021-01-27, 2021-01-2...</td>
      <td>6</td>
      <td>2</td>
      <td>6</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5.0</td>
      <td>6.0</td>
      <td>0.0</td>
      <td>2.813439</td>
    </tr>
    <tr>
      <th>148</th>
      <td>SellerToBuyer</td>
      <td>[5.0, 5.0, 5.0, 5.0, 5.0, 5.0]</td>
      <td>[2021-01-08, 2021-01-08, 2021-01-08, 2021-01-0...</td>
      <td>6</td>
      <td>3</td>
      <td>6</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5.0</td>
      <td>6.0</td>
      <td>0.0</td>
      <td>2.813439</td>
    </tr>
    <tr>
      <th>149</th>
      <td>SellerToBuyer</td>
      <td>[5.0, 5.0, 5.0, 5.0, 5.0, 5.0]</td>
      <td>[2021-01-11, 2021-01-11, 2021-01-11, 2021-01-1...</td>
      <td>6</td>
      <td>1</td>
      <td>6</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5.0</td>
      <td>6.0</td>
      <td>0.0</td>
      <td>2.813439</td>
    </tr>
    <tr>
      <th>146</th>
      <td>SellerToBuyer</td>
      <td>[5.0, 5.0, 5.0, 5.0, 5.0, 5.0]</td>
      <td>[2021-02-01, 2021-01-03, 2021-01-03, 2021-01-0...</td>
      <td>6</td>
      <td>3</td>
      <td>6</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5.0</td>
      <td>6.0</td>
      <td>0.0</td>
      <td>2.813439</td>
    </tr>
    <tr>
      <th>250</th>
      <td>SellerToBuyer</td>
      <td>[5.0, 5.0, 5.0, 5.0, 5.0]</td>
      <td>[2021-01-18, 2021-01-18, 2021-01-18, 2021-01-1...</td>
      <td>5</td>
      <td>1</td>
      <td>5</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>0.0</td>
      <td>2.742651</td>
    </tr>
  </tbody>
</table>
<p>100 rows × 14 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">seller</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ratingType&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;BuyerToSeller&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;rank&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">seller</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ratingType</th>
      <th>ratings</th>
      <th>ratings_date</th>
      <th>nof_reviews</th>
      <th>Number_of_date</th>
      <th>Number_of_5</th>
      <th>Number_of_4</th>
      <th>Number_of_3</th>
      <th>Number_of_2</th>
      <th>Number_of_1</th>
      <th>average_star</th>
      <th>Up_vote</th>
      <th>Down_vote</th>
      <th>rank</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>169625</th>
      <td>BuyerToSeller</td>
      <td>[1.0]</td>
      <td>[2021-02-08]</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1.00</td>
      <td>0.00</td>
      <td>1.00</td>
      <td>2.245054</td>
    </tr>
    <tr>
      <th>67646</th>
      <td>BuyerToSeller</td>
      <td>[1.0]</td>
      <td>[2021-01-11]</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1.00</td>
      <td>0.00</td>
      <td>1.00</td>
      <td>2.245054</td>
    </tr>
    <tr>
      <th>199610</th>
      <td>BuyerToSeller</td>
      <td>[1.0]</td>
      <td>[2021-01-19]</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1.00</td>
      <td>0.00</td>
      <td>1.00</td>
      <td>2.245054</td>
    </tr>
    <tr>
      <th>26597</th>
      <td>BuyerToSeller</td>
      <td>[1.0]</td>
      <td>[2021-01-22]</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1.00</td>
      <td>0.00</td>
      <td>1.00</td>
      <td>2.245054</td>
    </tr>
    <tr>
      <th>67654</th>
      <td>BuyerToSeller</td>
      <td>[1.0]</td>
      <td>[2021-01-24]</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1.00</td>
      <td>0.00</td>
      <td>1.00</td>
      <td>2.245054</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>4451</th>
      <td>BuyerToSeller</td>
      <td>[1.0, 1.0]</td>
      <td>[2021-01-06, 2021-01-05]</td>
      <td>2</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>1.00</td>
      <td>0.00</td>
      <td>2.00</td>
      <td>2.184374</td>
    </tr>
    <tr>
      <th>4994</th>
      <td>BuyerToSeller</td>
      <td>[1.0, 1.0]</td>
      <td>[2021-01-09, 2021-01-09]</td>
      <td>2</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>1.00</td>
      <td>0.00</td>
      <td>2.00</td>
      <td>2.184374</td>
    </tr>
    <tr>
      <th>4220</th>
      <td>BuyerToSeller</td>
      <td>[1.0, 1.0]</td>
      <td>[2021-01-25, 2021-01-25]</td>
      <td>2</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>1.00</td>
      <td>0.00</td>
      <td>2.00</td>
      <td>2.184374</td>
    </tr>
    <tr>
      <th>277</th>
      <td>BuyerToSeller</td>
      <td>[2.0, 1.0, 1.0, 1.0]</td>
      <td>[2021-01-20, 2021-01-21, 2021-01-21, 2021-01-21]</td>
      <td>4</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>3</td>
      <td>1.25</td>
      <td>0.25</td>
      <td>3.75</td>
      <td>2.114316</td>
    </tr>
    <tr>
      <th>279</th>
      <td>BuyerToSeller</td>
      <td>[1.0, 1.0, 1.0, 1.0]</td>
      <td>[2021-01-11, 2021-01-16, 2021-01-09, 2021-01-13]</td>
      <td>4</td>
      <td>4</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>4</td>
      <td>1.00</td>
      <td>0.00</td>
      <td>4.00</td>
      <td>2.079412</td>
    </tr>
  </tbody>
</table>
<p>200 rows × 14 columns</p>
</div></div></div>
</div>
<p>At this point we have for both the group a rank based not only on the avarage value but also on the amount of data obtained.</p>
<p>Following the principle of Bayesian statistics, as soon as new data comes in, we can incorporate it in the model and update our belief.</p>
</div>
<div class="section" id="question-is-the-overall-score-of-buyers-different-from-the-sellers-ones-are-more-critical-the-buyers-or-the-sellers">
<h2>Question: Is the overall score of Buyers different from the Sellers ones? Are more critical the Buyers or the Sellers?<a class="headerlink" href="#question-is-the-overall-score-of-buyers-different-from-the-sellers-ones-are-more-critical-the-buyers-or-the-sellers" title="Permalink to this headline">¶</a></h2>
<p>Let’s compute the overall posterior distribution of the buyers and the sellers</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy</span> <span class="k">import</span> <span class="n">stats</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.gridspec</span> <span class="k">as</span> <span class="nn">gridspec</span>

<span class="k">def</span> <span class="nf">jointplot</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Tool function to create a 3 part grid plot.&quot;&quot;&quot;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
    <span class="n">gs0</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=.</span><span class="mi">02</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=.</span><span class="mi">02</span><span class="p">)</span>
    <span class="n">ax1</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs0</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs0</span><span class="p">[:</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">ax3</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs0</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">:])</span>
    <span class="k">return</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span>


<span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">a_1</span><span class="p">,</span> <span class="n">b_1</span> <span class="o">=</span> <span class="p">(</span><span class="n">buyer</span><span class="o">.</span><span class="n">Up_vote</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">buyer</span><span class="o">.</span><span class="n">Down_vote</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">a_2</span><span class="p">,</span> <span class="n">b_2</span> <span class="o">=</span> <span class="p">(</span><span class="n">seller</span><span class="o">.</span><span class="n">Up_vote</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">seller</span><span class="o">.</span><span class="n">Down_vote</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.95</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1000</span><span class="p">))</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">beta</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.95</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">y_1</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">beta</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a_1</span><span class="p">,</span> <span class="n">b_1</span><span class="p">)</span>
<span class="n">y_2</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">beta</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a_2</span><span class="p">,</span> <span class="n">b_2</span><span class="p">)</span>

<span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">y_1</span><span class="p">,</span> <span class="n">y_2</span><span class="p">)</span>
<span class="n">Z</span> <span class="o">=</span> <span class="n">X</span> <span class="o">*</span> <span class="n">Y</span>

<span class="c1"># PLOT</span>
<span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span> <span class="o">=</span> <span class="n">jointplot</span><span class="p">()</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span> <span class="s1">&#39;Blues&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Buyer= Seller&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y_1</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y_2</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Buyer&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Seller&#39;</span><span class="p">)</span>

<span class="n">ax3</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/Example Ratings_52_0.png" src="../_images/Example Ratings_52_0.png" />
</div>
</div>
<p>Both the posteriors are shifted toward the high probability, however The Buyers have a highest probability meaning  that the buyers have received the highest votes</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./chaptExamples"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="Example%20Performance%20of%20searches%20per%20platform.html" title="previous page">Uncertainty of unique clicks rate in searches per platforms</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By The Jupyter Book Community<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="../_static/js/index.js"></script>
    
  </body>
</html>